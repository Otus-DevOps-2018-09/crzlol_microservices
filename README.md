# crzlol_microservices
crzlol microservices repository

## Homework-13. Docker-2
### Самостоятельное задание
Если запустить докер в pid-namespace host, то он попадет в общее пространство pidов и изоляции не будет.
 - Создали Dockerfile с описанием содержимого в контейнере
 - Создали образ
 - Зарегались на докерхабе и залили туда образ
 - Установили образ из докерхаба на локальную машину

### Задание со *
 - Реализовали поднятие инстансов с помощью Terraform
 - Создали несколько плейбуков Ansible для раската докера и приложения в контейнере
 - Ansible работает через динамик инвентори
 - Создали шаблон для пакера
 - Щаблон пакера использует те же плейбуки Ansible, базовый образ с докером готовится с помощью without-tags (чтобы исключить таски с раскатом приложения)

## Homework-14. Docker-3
### Самостоятельное задание
При сборке post-py приложений столкнулся с ошибкой "unable to execute 'gcc': No such file or directory".
Решил через допольнительный RUN apk add --no-cache --virtual .build-deps gcc musl-dev.

### Задание со *
 - Другие сетевые алиасы указал через --network-alias
 - Переменные окружения указал через --env
 - Собрал образы на Alpine Linux
 - Еще способ - убрать все WORKDIR из инструкций, и слепить все в один большой RUN. Это сделано в Dockerfile.1, но это не рекомендовано в документации как сложночитаемое решение
 - Создали структуру с контейнерами и Volume

 ## Homework-15. Docker-4
### Самостоятельное задание
Если запустить несколько раз
```
docker run --network host -d nginx
```
то в процессах мы увидим только один процесс. Я думаю, что это связано с тем, что так как мы запускаем все контейнеры в namespace хоста, то они не могут поделить 80 порт, поэтому
первый контейнер работает, а остальные не могут заполучить порт и падают.
 - docker-compose под кейс с множеством сетей изменили
 - параметризовали
 - в файл с расширением .env записали
 - в .gitignore добавили, example создали.
Базовое имя проекта образуется по-умолчанию из названия WORK_DIR для Docker-compose. Его можно задать через параметр --project-name для docker-compose или изменить название каталога.

### Задание со *
Идея следующая. Чтобы можно было изменять код приложений, надо код с ними монтировать в Volume. Чтобы Volume
был всегда актуальным, можно созадть еще один контейнер, который будет постоянно пушить свежие правки из гита
в Volume. Таким образом для обновления софта внутри контейнера, его просто надо будет пересоздать (это действие
можно затриггерить на пуш в мастер).
Я создал еще один контейнер source, внутри которого лежит скрипт, который раз в 10 сек пушит изменения в Volume.
Новый софт монтируется в docker-compose через volumes, рабочий каталог назначаем через working_dir.
P.S. почему-то при такой схеме приложение ui после нескольких обращений падает в ошибку из-за прометеуса,
разбираться не стал. Предполагаю, что это связано с билдом руби, потому что с обычным образом все ок.
Можно сделать скрипт, который будет при запуске контейнера делать bundle install && puma и вписать его в CMD, но
я считаю это костыльным и трудносопровождаемым решением, так оно противоречит логике конфигурации контейнеров
через docker-compose.

## Homework-16. Gitlab-CI-1
### Самостоятельное задание

## Homework-17. Gitlab-CI-2
### Самостоятельное задание
